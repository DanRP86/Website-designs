<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RE Agentic Workflow // V4.3</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&family=JetBrains+Mono:wght@300;400;500;700&display=swap');

        :root {
            --bg-dark: #0f172a;
            --panel-bg: rgba(30, 41, 59, 0.9);
            --accent-blue: #3b82f6;
            --text-primary: #f1f5f9;
            --border-color: rgba(148, 163, 184, 0.2);
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-dark);
            color: var(--text-primary);
            overflow: hidden;
        }

        .mono { font-family: 'JetBrains Mono', monospace; }

        /* --- BOOT SEQUENCE --- */
        #boot-screen {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: #020617;
            z-index: 9999;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
        }
        
        .boot-text {
            font-family: 'JetBrains Mono', monospace;
            color: #4ade80; 
            font-size: 1rem;
            margin-bottom: 0.8rem;
            opacity: 0;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            text-shadow: 0 0 8px rgba(74, 222, 128, 0.4);
        }

        .fade-in { animation: fadeIn 0.4s forwards; }
        @keyframes fadeIn { to { opacity: 1; transform: translateY(-2px); } }

        #start-btn {
            margin-top: 3rem;
            padding: 14px 36px;
            background: rgba(59, 130, 246, 0.1);
            border: 1px solid #3b82f6;
            color: #60a5fa;
            font-family: 'JetBrains Mono', monospace;
            font-weight: 700;
            font-size: 0.9rem;
            letter-spacing: 0.2em;
            cursor: pointer;
            opacity: 0;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            text-transform: uppercase;
            border-radius: 4px;
        }
        #start-btn:hover {
            background: #3b82f6;
            color: #ffffff;
            box-shadow: 0 0 40px rgba(59, 130, 246, 0.5);
            letter-spacing: 0.25em;
        }
        #start-btn.visible { opacity: 1; animation: pulseBtn 3s infinite; }
        
        @keyframes pulseBtn {
            0% { box-shadow: 0 0 0 0 rgba(59, 130, 246, 0.4); border-color: #3b82f6; }
            50% { box-shadow: 0 0 15px 2px rgba(59, 130, 246, 0.1); border-color: #60a5fa; }
            100% { box-shadow: 0 0 0 0 rgba(59, 130, 246, 0.4); border-color: #3b82f6; }
        }

        .boot-hidden {
            opacity: 0;
            pointer-events: none;
            transition: opacity 1.2s ease-in-out;
        }

        /* --- BACKGROUND MESH --- */
        #network-container {
            position: relative;
            width: 100%;
            height: 100%;
            background-image: 
                linear-gradient(rgba(30, 41, 59, 0.3) 1px, transparent 1px),
                linear-gradient(90deg, rgba(30, 41, 59, 0.3) 1px, transparent 1px);
            background-size: 60px 60px;
            background-color: #0b1120;
            box-shadow: inset 0 0 150px #020617;
        }

        /* --- NODES --- */
        .node {
            position: absolute;
            transform: translate(-50%, -50%);
            cursor: pointer;
            z-index: 10;
            transition: all 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        .node-inner {
            width: 58px;
            height: 58px;
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #1e293b;
            border: 1px solid #475569;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .node:hover .node-inner {
            transform: scale(1.15);
            border-color: var(--accent-blue);
            box-shadow: 0 0 25px rgba(59, 130, 246, 0.5);
            z-index: 20;
        }

        .node.active .node-inner {
            border-color: #38bdf8;
            background: #0f172a;
            box-shadow: 0 0 0 2px rgba(56, 189, 248, 0.2), 0 0 30px rgba(56, 189, 248, 0.25);
        }
        
        .node.active .node-inner i { color: #38bdf8; text-shadow: 0 0 10px rgba(56, 189, 248, 0.8); }

        /* Type Specific Styles */
        .node.human .node-inner { border-radius: 50%; border-color: #be185d; }
        .node.dept .node-inner { border-radius: 6px; border-color: #7c3aed; width: 52px; height: 52px; }
        .node.external .node-inner { border-style: dashed; border-color: #65a30d; }

        .node-label {
            position: absolute;
            top: 70px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 0.65rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            white-space: nowrap;
            background: rgba(15, 23, 42, 0.9);
            padding: 3px 8px;
            border-radius: 4px;
            pointer-events: none;
            border: 1px solid rgba(255,255,255,0.1);
            backdrop-filter: blur(4px);
            opacity: 0.8;
            transition: opacity 0.3s;
        }
        .node:hover .node-label { opacity: 1; }

        /* --- CONNECTIONS --- */
        svg {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none;
            z-index: 1;
        }

        path.connection {
            fill: none;
            stroke: #334155;
            stroke-width: 1;
            opacity: 0.15;
            transition: all 0.5s;
        }

        path.connection.active {
            stroke: #38bdf8;
            stroke-width: 2;
            opacity: 0.6;
            filter: drop-shadow(0 0 4px rgba(56,189,248,0.4));
        }
        
        path.connection.dept-link {
            stroke: #a78bfa; /* Violet */
            stroke-width: 1;
            stroke-dasharray: 4 4;
            opacity: 0.3;
        }
        path.connection.dept-link.active {
            stroke: #a78bfa;
            opacity: 0.8;
            filter: drop-shadow(0 0 4px rgba(167, 139, 250, 0.4));
        }

        /* Packets */
        .packet { fill: white; opacity: 0; }
        .connection.active ~ .packet { opacity: 1; animation: flow 2s infinite linear; }
        @keyframes flow { from { offset-distance: 0%; } to { offset-distance: 100%; } }

        /* --- UI PANELS --- */
        .glass-panel {
            background: var(--panel-bg);
            backdrop-filter: blur(12px);
            border: 1px solid var(--border-color);
        }

        .milestone-btn {
            background: rgba(15, 23, 42, 0.6);
            border: 1px solid rgba(255,255,255,0.1);
            color: #94a3b8;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .milestone-btn:hover { background: rgba(255,255,255,0.1); color: white; border-color: rgba(255,255,255,0.2); }
        .milestone-btn.active {
            background: rgba(59, 130, 246, 0.15);
            border-color: #3b82f6;
            color: #fff;
            box-shadow: 0 0 15px rgba(59, 130, 246, 0.25);
        }

        .card-detail {
            animation: slideInRight 0.4s cubic-bezier(0.16, 1, 0.3, 1);
        }

        @keyframes slideInRight {
            from { opacity: 0; transform: translateX(30px); }
            to { opacity: 1; transform: translateX(0); }
        }

        /* Scrollbar */
        ::-webkit-scrollbar { width: 5px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #475569; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: #64748b; }

        .tag {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.65rem;
            font-weight: 700;
            text-transform: uppercase;
            margin-right: 6px;
            margin-bottom: 6px;
            letter-spacing: 0.05em;
        }
        .tag-tech { background: rgba(59, 130, 246, 0.1); color: #60a5fa; border: 1px solid rgba(59, 130, 246, 0.2); }

    </style>
</head>
<body class="flex h-screen flex-col text-sm">

    <!-- BOOT SEQUENCE OVERLAY -->
    <div id="boot-screen">
        <div id="boot-log" class="text-center mb-8 flex flex-col items-center"></div>
        <button id="start-btn" onclick="startSystem()">[ INITIALIZE SYSTEM ]</button>
    </div>

    <!-- Header -->
    <header class="h-16 glass-panel border-b border-slate-700/50 flex items-center justify-between px-6 z-50 shrink-0 shadow-2xl">
        <!-- Left Side: Title & Icon (Strictly Left Aligned) -->
        <div class="flex items-center gap-4 flex-1">
            <div class="w-10 h-10 rounded-lg bg-blue-600 flex items-center justify-center text-white shadow-lg shadow-blue-500/30 border-t border-blue-400 shrink-0">
                <i class="fa-solid fa-layer-group text-lg"></i>
            </div>
            <div class="flex flex-col items-start justify-center">
                <h1 class="text-base font-bold tracking-widest text-white uppercase font-mono leading-tight">Agentic Organization</h1>
                <p class="text-[10px] text-slate-400 tracking-wider uppercase leading-tight">RE & WX Operating Model // v4.3</p>
            </div>
        </div>
        
        <!-- Center: Milestones -->
        <div class="flex gap-2">
            <button onclick="setMilestone(1)" id="btn-m1" class="milestone-btn px-5 py-2 rounded text-[10px] font-bold uppercase tracking-wider">
                01. Strategy
            </button>
            <button onclick="setMilestone(2)" id="btn-m2" class="milestone-btn px-5 py-2 rounded text-[10px] font-bold uppercase tracking-wider">
                02. Design
            </button>
            <button onclick="setMilestone(3)" id="btn-m3" class="milestone-btn px-5 py-2 rounded text-[10px] font-bold uppercase tracking-wider">
                03. Build
            </button>
            <button onclick="setMilestone(4)" id="btn-m4" class="milestone-btn px-5 py-2 rounded text-[10px] font-bold uppercase tracking-wider">
                04. Live
            </button>
        </div>

        <!-- Right: Status -->
        <div class="flex-1 flex justify-end">
            <div class="text-[10px] text-slate-500 font-mono flex items-center gap-2">
                <span class="w-2 h-2 rounded-full bg-green-500 animate-pulse"></span>
                <span class="text-green-400 font-bold">ACTIVE</span>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <div class="flex flex-1 overflow-hidden relative">
        
        <!-- Network Map -->
        <main class="flex-1 relative" id="network-container">
            <svg id="connections-layer"></svg>
            <div id="nodes-layer"></div>
            
            <!-- Legend -->
            <div class="absolute bottom-6 left-6 glass-panel p-4 rounded-xl border border-slate-700/50 z-20 shadow-2xl">
                <div class="text-[9px] font-bold text-slate-500 uppercase mb-3 tracking-widest border-b border-slate-700 pb-2">Node Type</div>
                <div class="flex flex-col gap-2">
                    <div class="flex items-center gap-3">
                        <div class="w-3 h-3 rounded-full border-2 border-pink-500 bg-pink-500/20 shadow-[0_0_8px_rgba(236,72,153,0.4)]"></div> 
                        <span class="text-[10px] text-slate-300 font-mono">Supervisor (Human)</span>
                    </div>
                    <div class="flex items-center gap-3">
                        <div class="w-3 h-3 rounded bg-sky-500 shadow-[0_0_8px_rgba(14,165,233,0.5)] border border-sky-400"></div> 
                        <span class="text-[10px] text-slate-300 font-mono">Specialized Agent</span>
                    </div>
                    <div class="flex items-center gap-3">
                        <div class="w-3 h-3 rounded bg-violet-600/50 border border-violet-500 shadow-[0_0_8px_rgba(139,92,246,0.4)]"></div> 
                        <span class="text-[10px] text-slate-300 font-mono">Core Department</span>
                    </div>
                </div>
            </div>
        </main>

        <!-- Sidebar: Agent Specs -->
        <aside class="w-[500px] glass-panel border-l border-slate-700/50 flex flex-col z-40 shadow-2xl backdrop-blur-xl">
            
            <!-- Empty State -->
            <div id="empty-state" class="flex-1 flex flex-col items-center justify-center text-slate-500 p-12 text-center">
                <div class="w-24 h-24 rounded-full bg-slate-800/50 flex items-center justify-center mb-6 border border-slate-700 shadow-inner">
                    <i class="fa-solid fa-circle-nodes text-4xl opacity-30"></i>
                </div>
                <h3 class="text-sm font-bold text-slate-300 uppercase tracking-widest mb-3">System Inspector</h3>
                <p class="text-xs max-w-xs leading-relaxed text-slate-400">Select any node in the neural mesh to decrypt its functional logic, data dependencies, and downstream effects.</p>
            </div>

            <!-- Detail Content (Hidden by default) -->
            <div id="agent-detail" class="hidden flex-1 flex-col h-full card-detail bg-slate-900/40">
                
                <!-- Header -->
                <div class="p-8 border-b border-slate-700/50 bg-gradient-to-r from-slate-800/90 to-transparent">
                    <div class="flex justify-between items-start mb-5">
                        <div class="w-16 h-16 rounded-xl bg-slate-800 flex items-center justify-center text-3xl text-blue-400 border border-slate-600 shadow-lg relative overflow-hidden" id="detail-icon-container">
                            <div class="absolute inset-0 bg-blue-500/10 animate-pulse"></div>
                            <span id="detail-icon"></span>
                        </div>
                        <span class="text-[10px] font-mono text-cyan-400 bg-cyan-950/40 px-3 py-1 rounded border border-cyan-800/50 tracking-wider" id="detail-id">AGENT_ID</span>
                    </div>
                    <h2 class="text-2xl font-bold text-white mb-2 tracking-tight" id="detail-title">Agent Name</h2>
                    <p class="text-xs text-blue-300 font-bold uppercase tracking-wider font-mono" id="detail-role">Role Description</p>
                </div>

                <!-- Scrollable Body -->
                <div class="flex-1 overflow-y-auto p-8 space-y-8 custom-scrollbar">
                    
                    <!-- Description -->
                    <div class="relative">
                        <div class="absolute -left-4 top-1 bottom-1 w-1 bg-gradient-to-b from-blue-500 to-transparent rounded-full opacity-50"></div>
                        <h4 class="text-[10px] font-bold text-slate-500 uppercase tracking-widest mb-3">Functional Overview</h4>
                        <p class="text-sm text-slate-300 leading-relaxed font-light text-justify" id="detail-desc">
                            Description text...
                        </p>
                    </div>

                    <!-- Tech Stack -->
                    <div class="bg-slate-900/60 p-5 rounded-xl border border-slate-700/50 shadow-inner">
                        <h4 class="text-[10px] font-bold text-blue-500 uppercase tracking-widest mb-4 flex items-center gap-2">
                            <i class="fa-solid fa-code-branch"></i> Technical Architecture
                        </h4>
                        <p class="text-xs text-slate-400 mb-4 font-mono leading-relaxed" id="detail-tech-desc">
                            Tech details...
                        </p>
                        <div id="detail-tags" class="flex flex-wrap"></div>
                    </div>

                    <!-- Connectivity -->
                    <div>
                        <h4 class="text-[10px] font-bold text-slate-500 uppercase tracking-widest mb-4">I/O Protocol</h4>
                        <div class="space-y-3 font-mono">
                            <div class="flex items-start gap-4 p-3 rounded-lg bg-slate-800/30 border border-slate-700/30 hover:border-slate-600 transition-colors">
                                <div class="mt-1.5 w-2 h-2 rounded-full bg-green-500 shadow-[0_0_6px_lime]"></div>
                                <div>
                                    <span class="text-[10px] text-green-400 uppercase font-bold block mb-1">Data Ingestion</span>
                                    <p class="text-xs text-slate-300 leading-relaxed" id="detail-inputs">Data sources...</p>
                                </div>
                            </div>
                            <div class="flex items-start gap-4 p-3 rounded-lg bg-slate-800/30 border border-slate-700/30 hover:border-slate-600 transition-colors">
                                <div class="mt-1.5 w-2 h-2 rounded-full bg-blue-500 shadow-[0_0_6px_cyan]"></div>
                                <div>
                                    <span class="text-[10px] text-blue-400 uppercase font-bold block mb-1">Deliverables</span>
                                    <p class="text-xs text-slate-300 leading-relaxed" id="detail-outputs">Deliverables...</p>
                                </div>
                            </div>
                            <div class="flex items-start gap-4 p-3 rounded-lg bg-slate-800/30 border border-slate-700/30 hover:border-slate-600 transition-colors">
                                <div class="mt-1.5 w-2 h-2 rounded-full bg-purple-500 shadow-[0_0_6px_violet]"></div>
                                <div>
                                    <span class="text-[10px] text-purple-400 uppercase font-bold block mb-1">Core Link</span>
                                    <p class="text-xs text-slate-300 leading-relaxed" id="detail-dept">Department...</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </aside>

    </div>

    <script>
        // --- BOOT SEQUENCE ---
        function startSystem() {
            const screen = document.getElementById('boot-screen');
            screen.classList.add('boot-hidden');
            setTimeout(() => {
                screen.style.display = 'none';
                init(); 
            }, 1200);
        }

        function runBootSequence() {
            const container = document.getElementById('boot-log');
            const btn = document.getElementById('start-btn');
            // Specific strings requested
            const messages = [
                "analyzing department...",
                "interpreting milestones...",
                "evaluating process...",
                "Assessing RE and WX accountabilities..."
            ];

            let i = 0;
            const interval = setInterval(() => {
                if (i < messages.length) {
                    const p = document.createElement('div');
                    p.className = 'boot-text fade-in';
                    p.innerText = `> ${messages[i]}`;
                    container.appendChild(p);
                    i++;
                } else {
                    clearInterval(interval);
                    setTimeout(() => {
                        btn.classList.add('visible');
                    }, 500);
                }
            }, 900); 
        }

        // --- DATA MODEL (REFINED POSITIONS) ---

        const agents = [
            // CENTER
            { 
                id: 'wx', label: 'RE & WX Manager', type: 'human', icon: 'fa-user-tie', x: 50, y: 50,
                role: 'Strategic Orchestrator (M-Shaped Supervisor)',
                desc: 'Operates "Above the Loop" as an M-Shaped Supervisor. Instead of chasing tasks or manually coordinating spreadsheets, this role focuses on strategic exception management (e.g., approving budget variances >5% or high-risk lease clauses) and defining the target cultural outcome. They interact with the ecosystem via a Decision Dashboard, validating the "Business Case" and "Design Vision" built by their agentic squads.',
                techDesc: 'Executive Decision Support System (DSS) with Predictive Analytics. Flags "Red Risks" requiring human judgment while auto-approving standard "Green" workflows.',
                tags: ['Strategy', 'Exception Mgmt', 'Political Capital'],
                inputs: 'Business Case (NPV/IRR), Visual Layouts, Risk Report',
                outputs: 'Go/No-Go Decision, Cultural Vision',
                dept: 'Real Estate / WX'
            },

            // CORE DEPARTMENTS (RIGHT COLUMN - "Backbone")
            { 
                id: 'legal_core', label: 'Legal Dept', type: 'dept', icon: 'fa-scale-balanced', x: 92, y: 25,
                role: 'Corporate Risk Governance',
                desc: 'The centralized Legal Function. Defines the "Risk Playbook" (e.g., liability caps, indemnification limits) that specialized agents must follow. It handles high-level escalations where the AI Confidence Score is low, ensuring corporate governance is never breached by autonomous agents.',
                techDesc: 'Enterprise Legal Management (ELM) integration (e.g., TeamConnect).',
                tags: ['Risk Governance', 'Playbook Definition'],
                inputs: 'Escalated Lease Clauses, Compliance Breaches',
                outputs: 'Approved Deviations, Playbook Updates',
                dept: 'Legal'
            },
            { 
                id: 'pnc_core', label: 'P&C / HR', type: 'dept', icon: 'fa-users', x: 92, y: 50,
                role: 'People Strategy & Policy',
                desc: 'The HR function responsible for RTO (Return-to-Office) policies and Change Management. It acts as the "Social Sensor" receiver, consuming aggregated sentiment data to adjust communication strategies dynamically.',
                techDesc: 'HRIS Data Lake (Workday/BambooHR) + People Analytics.',
                tags: ['Change Mgmt', 'RTO Policy'],
                inputs: 'Aggregated Sentiment Trends (Pulse)',
                outputs: 'Policy Updates, Crisis Comms',
                dept: 'HR'
            },
            { 
                id: 'fin_core', label: 'Finance', type: 'dept', icon: 'fa-building-columns', x: 92, y: 75,
                role: 'Treasury & Controllership',
                desc: 'The Corporate Finance guardian holding the keys to the bank account. Responsible for releasing actual funds (Treasury) and validating capital allocation against the corporate P&L. It relies on the RE Analyst for project-level validation but executes the final wire transfers.',
                techDesc: 'ERP Backbone (SAP S/4HANA / Oracle).',
                tags: ['Treasury', 'GL Control'],
                inputs: 'Capital Funding Requests (CFR), Payment Certificates',
                outputs: 'Wire Transfers, Cost Center Allocation',
                dept: 'Finance'
            },

            // MILESTONE 1: STRATEGY (TOP LEFT)
            { 
                id: 'scout', label: 'Scout', type: 'internal', icon: 'fa-binoculars', x: 12, y: 15,
                role: 'Market Intelligence Engine',
                desc: 'Scrapes and normalizes unstructured real estate listings. It enriches raw listing data by calculating the "Commute Impact Score" for the entire workforce using anonymized home zip codes, filtering thousands of options down to the 3 most efficient buildings.',
                techDesc: 'Web Scraping (Selenium) + Geo-Spatial APIs (Google Distance Matrix). Clustering algorithms for centroid optimization.',
                tags: ['Scraping', 'Geo-Spatial', 'Optimization'],
                inputs: 'Search Radius, Budget Cap, Employee Home Data',
                outputs: 'Enriched Listing Data -> RE Analyst',
                dept: 'Real Estate'
            },
            { 
                id: 'fin_analyst', label: 'RE Analyst', type: 'internal', icon: 'fa-chart-line', x: 25, y: 25,
                role: 'Financial Modeler',
                desc: 'The specialized RE Financial Agent. It digests market rent data and fit-out estimates to construct a robust Business Case. It calculates NPV (Net Present Value), IRR, and Cash Flow impacts (GAAP vs Cash), ensuring the project meets the corporate "Hurdle Rate" before it reaches the Manager.',
                techDesc: 'Automated Financial Modeling (Python/Pandas). Generates Excel-compatible models and JSON payloads for the ERP.',
                tags: ['NPV/IRR', 'Scenario Modeling'],
                inputs: 'Market Rents (Scout), Fit-out Est (Architect)',
                outputs: 'Validated Business Case (NPV/Cash Flow)',
                dept: 'Real Estate'
            },
            { 
                id: 'lease_ai', label: 'Lease AI', type: 'internal', icon: 'fa-file-contract', x: 65, y: 20, /* Moved slightly up */
                role: 'Semantic Lease Review',
                desc: 'Ingests draft leases (PDF/Word). Uses NLP to extract and compare key variables (Base Rent, TI Allowance, Holdover, Subleasing) against the Corporate Playbook. It creates an automated "Redline" markup for clauses that deviate from the standard.',
                techDesc: 'LLM fine-tuned on Commercial Real Estate Law. Vector Database (RAG) for clause comparison.',
                tags: ['Semantic Analysis', 'Auto-Redlining'],
                inputs: 'Draft Lease Document (Unstructured)',
                outputs: 'Redlined Lease, Risk Summary Report',
                dept: 'Real Estate'
            },

            // MILESTONE 2: DESIGN (TOP RIGHT)
            { 
                id: 'architect', label: 'Gen Design', type: 'external', icon: 'fa-pen-ruler', x: 38, y: 15, /* Pushed right a bit */
                role: 'Generative Optimization',
                desc: 'External AI Design Partner. Uses multi-objective optimization algorithms to generate thousands of "Test Fits" in seconds. It balances conflicting constraints: maximizing headcount density while maximizing access to natural light and adherence to adjacency requirements.',
                techDesc: 'Generative Adversarial Networks (GANs) & Parametric Design engines.',
                tags: ['Generative Design', 'Multi-objective Opt'],
                inputs: 'Floorplan (.DWG/BIM), Headcount Ratios',
                outputs: 'Optimized Layout Scenarios (2D/3D)',
                dept: 'External Partner'
            },
            { 
                id: 'code_bot', label: 'Code Bot', type: 'internal', icon: 'fa-shield-halved', x: 60, y: 10,
                role: 'Regulatory Compliance',
                desc: 'The "Guardrail" Agent. Parses design files (IFC/BIM) and checks them against a digitized database of Local Building Codes (IBC), Fire Safety regulations, and ADA (accessibility) standards. Ensures zero-defect designs before human review.',
                techDesc: 'Rule-Based Expert System + Computer Vision for 2D plan analysis. Queries local municipal code databases.',
                tags: ['Code Auditing', 'BIM Analysis'],
                inputs: 'Proposed Layouts (BIM/CAD)',
                outputs: 'Compliance Heatmap, Violation Report',
                dept: 'Real Estate'
            },

            // MILESTONE 3: BUILD (BOTTOM LEFT - REORGANIZED)
            // Cluster: RFP -> Contract -> Capex (Left to Right Flow)
            { 
                id: 'rfp_ai', label: 'RFP Agent', type: 'internal', icon: 'fa-list-check', x: 12, y: 65,
                role: 'Procurement Automation',
                desc: 'Orchestrates the Design-Bid-Build tender. It generates the RFP package, sends it to pre-qualified GCs, and automatically "levels" incoming bids (normalizing exclusions and scope gaps) to create a true apple-to-apple comparison matrix.',
                techDesc: 'NLU for scope extraction from PDF bids. Automated email orchestration.',
                tags: ['Bid Leveling', 'Scope Normalization'],
                inputs: 'Construction Drawings, Vendor List',
                outputs: 'Bid Leveling Matrix, Recommendation',
                dept: 'Procurement'
            },
            { 
                id: 'db_legal', label: 'D&B Contract', type: 'internal', icon: 'fa-file-signature', x: 30, y: 75,
                role: 'Contract Assembly',
                desc: 'Automates creation of the Construction Contract (e.g., AIA A133). Pulls data from the RFP award and merges it with the Legal Dept template. Verifies vendor Insurance Certificates (COI) meet corporate limits via API before allowing signature.',
                techDesc: 'CLM Automation + Insurance API verification.',
                tags: ['Contract Assembly', 'COI Verification'],
                inputs: 'Winning Bid Details, Vendor COI',
                outputs: 'Execution-ready Contract',
                dept: 'Real Estate'
            },
            { 
                id: 'capex', label: 'Capex Bot', type: 'internal', icon: 'fa-magnifying-glass-dollar', x: 45, y: 85,
                role: 'Project Controller',
                desc: 'The relentless spend monitor. Processes Pay Applications (AIA G702/G703), validates % completion against schedule, and ensures Lien Waivers are collected. Detects "Scope Creep" by comparing invoice line items against the original GMP contract.',
                techDesc: 'OCR specialized in tabular financial data + Anomaly Detection.',
                tags: ['AIA G702 Processing', 'Lien Waivers'],
                inputs: 'Invoices, Change Orders, Pay Apps',
                outputs: 'Validated Payment Certificate',
                dept: 'Project Mgmt'
            },

            // MILESTONE 4: LIVE (BOTTOM RIGHT)
            { 
                id: 'concierge', label: 'Concierge', type: 'internal', icon: 'fa-bell-concierge', x: 65, y: 80,
                role: 'Hyper-Personalized Support',
                desc: 'A 24/7 AI Assistant for every employee. Unlike a static FAQ, it has context: it knows where the user sits, their IT equipment, and team preferences. Handles wayfinding ("Where is the Marketing zone?") and locker assignments.',
                techDesc: 'RAG LLM connected to Building Management Systems (IoT) and Employee Directory.',
                tags: ['Contextual Support', 'IoT Integration'],
                inputs: 'User Queries, IoT Signals',
                outputs: 'Answers, Ticket Routing',
                dept: 'WX'
            },
            { 
                id: 'pulse', label: 'Pulse', type: 'internal', icon: 'fa-heart-pulse', x: 75, y: 65,
                role: 'Real-time Sentiment Engine',
                desc: 'The "Ears" of the office. continuously monitors public digital channels. Uses Topic Modeling to cluster thousands of comments into actionable insights (e.g., "30% of users report acoustic issues in Phone Booths"), triggering alerts for P&C.',
                techDesc: 'NLP Sentiment Analysis & Clustering Algorithms. Anomaly detection for cultural toxicity.',
                tags: ['Topic Modeling', 'Cultural Health'],
                inputs: 'Survey Data, Public Chat Logs',
                outputs: 'Heatmaps, Alerts to P&C',
                dept: 'WX / HR'
            }
        ];

        const connections = [
            // M1 Strategy
            { from: 'wx', to: 'scout', m: [1] },
            { from: 'scout', to: 'fin_analyst', m: [1] }, 
            { from: 'fin_analyst', to: 'fin_core', m: [1], type: 'dept' },
            { from: 'fin_core', to: 'fin_analyst', m: [1], type: 'dept' },
            { from: 'fin_analyst', to: 'wx', m: [1] },
            
            { from: 'wx', to: 'lease_ai', m: [1] }, 
            { from: 'lease_ai', to: 'legal_core', m: [1], type: 'dept' }, 

            // M2 Design
            { from: 'wx', to: 'architect', m: [2] },
            { from: 'architect', to: 'code_bot', m: [2] },
            { from: 'code_bot', to: 'architect', m: [2] }, 
            { from: 'code_bot', to: 'wx', m: [2] },

            // M3 Build (FLOW FIXED)
            { from: 'wx', to: 'rfp_ai', m: [3] },
            { from: 'rfp_ai', to: 'db_legal', m: [3] },
            { from: 'db_legal', to: 'capex', m: [3] },
            { from: 'db_legal', to: 'legal_core', m: [3], type: 'dept' }, // Escalation
            { from: 'capex', to: 'fin_core', m: [3], type: 'dept' }, // Payment
            
            // M4 Live
            { from: 'wx', to: 'concierge', m: [4] },
            { from: 'pulse', to: 'wx', m: [4] },
            { from: 'pulse', to: 'pnc_core', m: [4], type: 'dept' } 
        ];

        // --- RENDER LOGIC ---

        function init() {
            renderNodes();
            renderConnections();
            setMilestone(1);
        }

        function renderNodes() {
            const container = document.getElementById('nodes-layer');
            container.innerHTML = '';
            
            agents.forEach(a => {
                const node = document.createElement('div');
                node.className = `node ${a.type}`;
                node.id = `node-${a.id}`;
                node.style.left = `${a.x}%`;
                node.style.top = `${a.y}%`;
                node.onclick = () => selectAgent(a);
                
                node.innerHTML = `
                    <div class="node-inner">
                        <i class="fa-solid ${a.icon} text-slate-300 text-2xl"></i>
                    </div>
                    <div class="node-label">${a.label}</div>
                `;
                container.appendChild(node);
            });
        }

        function renderConnections() {
            const svg = document.getElementById('connections-layer');
            svg.innerHTML = '';
            const rect = document.getElementById('network-container').getBoundingClientRect();
            
            connections.forEach((c, i) => {
                const start = agents.find(a => a.id === c.from);
                const end = agents.find(a => a.id === c.to);
                
                const group = document.createElementNS("http://www.w3.org/2000/svg", "g");
                const path = document.createElementNS("http://www.w3.org/2000/svg", "path");
                
                path.setAttribute("id", `conn-${i}`);
                path.setAttribute("class", `connection ${c.type === 'dept' ? 'dept-link' : ''}`);
                
                // Calculate Coords
                const x1 = (start.x / 100) * rect.width;
                const y1 = (start.y / 100) * rect.height;
                const x2 = (end.x / 100) * rect.width;
                const y2 = (end.y / 100) * rect.height;
                
                path.setAttribute("d", `M ${x1} ${y1} L ${x2} ${y2}`);
                
                // Packet
                const packet = document.createElementNS("http://www.w3.org/2000/svg", "circle");
                packet.setAttribute("r", "2.5");
                packet.setAttribute("class", "packet");
                packet.setAttribute("id", `pack-${i}`);
                
                const mpath = document.createElementNS("http://www.w3.org/2000/svg", "animateMotion");
                mpath.setAttribute("dur", "2s");
                mpath.setAttribute("repeatCount", "indefinite");
                mpath.setAttribute("path", `M ${x1} ${y1} L ${x2} ${y2}`);
                
                packet.appendChild(mpath);
                group.appendChild(path);
                if(c.type !== 'dept') group.appendChild(packet); // Only flow packets on active workflow lines
                
                svg.appendChild(group);
            });
        }

        let currentMilestone = 1;

        function setMilestone(m) {
            currentMilestone = m;
            
            // Buttons
            document.querySelectorAll('.milestone-btn').forEach((b, i) => {
                if(i+1 === m) b.classList.add('active');
                else b.classList.remove('active');
            });

            // Active State Logic
            const activeIds = new Set();
            const activeConnIdx = new Set();

            connections.forEach((c, i) => {
                if (c.m.includes(m)) {
                    activeIds.add(c.from);
                    activeIds.add(c.to);
                    activeConnIdx.add(i);
                }
            });

            // Update Nodes
            agents.forEach(a => {
                const el = document.getElementById(`node-${a.id}`);
                if (activeIds.has(a.id)) el.classList.add('active');
                else el.classList.remove('active');
            });

            // Update Lines
            connections.forEach((c, i) => {
                const line = document.getElementById(`conn-${i}`);
                const pack = document.getElementById(`pack-${i}`);
                
                if (activeConnIdx.has(i)) {
                    line.classList.add('active');
                    if(pack) pack.style.display = 'block';
                } else {
                    line.classList.remove('active');
                    if(pack) pack.style.display = 'none';
                }
            });
        }

        function selectAgent(a) {
            document.getElementById('empty-state').classList.add('hidden');
            document.getElementById('agent-detail').classList.remove('hidden');
            
            // Populate Data
            document.getElementById('detail-id').innerText = `ID: ${a.id.toUpperCase()}`;
            document.getElementById('detail-title').innerText = a.label;
            document.getElementById('detail-role').innerText = a.role;
            document.getElementById('detail-desc').innerText = a.desc;
            document.getElementById('detail-tech-desc').innerText = a.techDesc;
            document.getElementById('detail-inputs').innerText = a.inputs;
            document.getElementById('detail-outputs').innerText = a.outputs;
            document.getElementById('detail-dept').innerText = a.dept;
            
            // Icon
            const iconContainer = document.getElementById('detail-icon-container');
            const icon = document.getElementById('detail-icon');
            icon.innerHTML = `<i class="fa-solid ${a.icon}"></i>`;
            
            // Tags
            const tagContainer = document.getElementById('detail-tags');
            tagContainer.innerHTML = '';
            a.tags.forEach(t => {
                const tag = document.createElement('span');
                tag.className = 'tag tag-tech';
                tag.innerText = t;
                tagContainer.appendChild(tag);
            });
        }

        // Resize Handler
        window.onresize = () => renderConnections();

        // Start animation immediately
        window.onload = runBootSequence;

    </script>
</body>
</html>
